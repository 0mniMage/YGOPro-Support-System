<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">

    <title>SalvationDevelopment International Launcher</title>
    <style>
        @import url(http://weloveiconfonts.com/api/?family=fontawesome);
        
        /* fontawesome */
        [class*="fontawesome-"]:before {
          font-family: 'FontAwesome', sans-serif;
        }
    </style>

    <!-- Place favicon.ico and apple-touch-icon(s) in the root directory -->

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/main.css">

    <link rel="stylesheet" href="css/viewanimations.css">
    <link rel="stylesheet" href="css/z-index.css">

    <script src="js\vendor\primus.js"></script>
    <script src="js/vendor/jquery-1.11.0.min.js"></script>
</head>

<body>
    <iframe height="92%" id="salvationdevelopment" role="main" src="http://salvationdevelopment.com" width="100%" style="border:none;"></iframe>


    <footer id="staticbar">
        <section id="hostSettings">
            <div class="container">
                <h2>Settings</h2>
                <label>Ranked</label>
                <input type="radio" name="ranked" value="R" />Yes
                <input type="radio" name="ranked" value="U" checked />No
                <br />
                <label>Ban List</label>
                <select id="creategamebanlist">
                    <option value="0" selected>2013.9.1(TCG)</option>
                    <option value="1">2013.9.1(OCG)</option>
                    <option value="2">2013.3.1</option>
                    <option value="3">2012.9.1</option>
                    <option value="4">2012.3.1</option>
                    <option value="5">2011.9.1</option>
                    <option value="6">Traditional</option>
                    <option value="7">Unlimited</option>
                    <option value="8">Mega-Banned</option>
                    <option value="9">TBC</option>
                </select>
                <br />
                <label>Card Pool</label>
                <select id="creategamecardpool">
                    <option value="0">OCG</option>
                    <option value="1">TCG</option>
                    <option value="2" selected>OCG/TCG</option>
                    <option value="3">Anime</option>

                </select>
                <br />
                <label>Duel Mode</label>
                <select id="creategameduelmode">
                    <option value="0" selected>Single</option>
                    <option value="1">Match</option>
                    <option value="2">Tag</option>

                </select>
                <br />
                <label>Time Limit</label>
                <select id="creategametimelimit">
                    <option value="0" selected>3 Minutes</option>
                    <option value="1">5 Minutes</option>

                </select>
                <br />

                <h2>Additional Options</h2>
                <label>Enable Priority</label>
                <input type="checkbox" id="enableprio">
                <br />
                <label>Disable Check Deck</label>
                <input type="checkbox" id="discheckdeck">
                <br />
                <label>Disable Shuffle Deck</label>
                <input type="checkbox" id="disshuffledeck">
                <br />
                <br />
                <label>Lifepoints</label>
                <input type="number" value="8000" id="creategamelp" min="1" />
                <br />
                <label>Password</label>
                <input type="text" id="creategamepassword" id="creategamepass" max="5" />
                <br />
                <div class="button" id="creategameok" onclick='setHostSettings();closeAllScreens();'>OK</div>
                <div class="button" id="creategamecancel" onclick='closeAllScreens();'>Cancel</div>

            </div>
        </section>
        <section id="settings">
            <div class='section-content'>

                <div>
                    <h3>Game Settings</h3>
                    <label>Auto Card Placement</label>
                    <input type="checkbox" data-localhost="auto_card_placing" />
                    <br />
                    <label>Random Card Placement</label>
                    <input type="checkbox" data-localhost="random_card_placing" />
                    <br />
                    <label>Auto Chain Order</label>
                    <input type="checkbox" data-localhost="auto_chain_order" />
                    <br />
                    <label>Enable Sound</label>
                    <input type="checkbox" data-localhost="enable_music" />
                    <br />
                    <label>Enable DirectX</label>
                    <input type="checkbox" data-localhost="use_d3d" />
                    <br />
                    <label>No Delay for Chains</label>
                    <input type="checkbox" data-localhost="no_delay_for_chain" />
                    <br />
                    <label>Enable Music</label>
                    <input type="checkbox" data-localhost="enable_music" />
                    <br />
                    <label>Fullscreen</label>
                    <input type="checkbox" data-localhost="fullscreen" />
                    <br />
                    <label>Enable User Covers</label>
                    <input type="checkbox" data-localhost="enable_sleeve_loading" />
                    <br />
                    <label>Anti Aliasing</label>
                    <input type="checkbox" data-localhost="antialias" />
                    <label>Enable Microphone</label>

                    <label>Skin</label>
                    <select>
                        <option value="default">Default</option>
                    </select>
                    <button onclick="saveSettings();closeAllScreens()">Save</button>
                    <button onclick="applySettings();closeAllScreens()">Cancel</button>
                    <br />
                </div>
        </section>
        <marquee id='servermessages'>

        </marquee>
        <div id="staticcontrols">
            <div id="LANMode" onclick="ygopro('');">
                LAN Mode
            </div>
            <div id="rundeckedit" onclick="ygopro('-d');">
                Deck Edit
            </div>
            <div id="runereplays" onclick="ygopro('-r');">
                Replays
            </div>
            <div id="runHost" onclick="openScreen('#hostSettings');">
                Host
            </div>
            <div id="checkmateServer" onclick="connectToCheckmateServer();">
                Checkmate Server
            </div>
            <div id="runHost" onclick="openScreen('#settings');">
                Settings
            </div>

        </div>
    </footer>
    <script>
        applySettings();
        var http = require('http');
	        var fs = require('fs');
	        var walk = require('fs-walk');
	        
	        function update(location, file) {
	            var files = {};
	            walk.walkSync(location, function (basedir, filename, stat, next) {
	                files[filename] = stat.mtime.getTime() || 0;
	            });
	            return files;
	        }
	        function isOldFile(filename, utc) {
                try {
                    var stats = fs.lstatSync(filename);
                    var current = stats.mtime.toUTCString();
                    if (current < utc) {
                        return true;
                    } else {
                        return false;
                    }
                } catch (error) {
                    return null;
                }
            }
        process.on('uncaughtException', function (err) {
  console.log('Caught exception: ' + err);
});
            function updateCheckFile(file) {
                if (file.type !== 'folder') {
                    if (isOldFile(file.path, file.modified));
                    $('#servermessages').text('Updating...'+file.path);
                    alert();
                    download('http://localhost/launcher/'+file.path,file.path);
                } else if (file.type === 'folder') {
                    for (var i = 0; file.subfolder.length > i; i++) {

                        updateCheckFile(file.subfolder[i]);
                    }
                    
                }
            }
	        function download(url, dest, callback) {
	          var file = fs.createWriteStream(dest);
	          var request = http.get(url, function(response) {
	            response.pipe(file);
	            file.on('finish', function() {
	              file.close(callback);  // close() is async, call cb after close completes.
                    console.log(url)
	            });
	          });
	        };
	
	        $.get('http://localhost/wordpress/launcher/manifest/ygopro.json',function(data){
               
                   console.log(data)
                  updateCheckFile(data)});
	        var child_process = require('child_process');
	        $('#servermessages').text('Server Messages will spawn here.');
	        
	        function closeAllScreens() {
                $('#salvationdevelopment').css('display', 'block');
	            $('#staticbar section').css('display', 'none');
	        }
	
	        function openScreen(id) {
	            
	            closeAllScreens();
                $('#salvationdevelopment').css('display', 'none');
	            $(id).toggle();
	        }
	
	        function joinGamelist() {
	            primus.write({
	                action: 'join'
	            });
	        }
	        function leaveGamelist() {
	            primus.write({
	                action: 'leave'
	            });
	        }
	        function hostGame(parameters){
	            primus.write({
	                serverEvent: 'hostgame',
	                format: parameters
	            });
	        }
	        function setHostSettings(){
	            
	            function randomString(len, charSet) {
	                charSet = charSet || 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	                var randomstring = '';
	                for (var i = 0; i < len; i++) {
	                    var randomPoz = Math.floor(Math.random() * charSet.length);
	                    randomstring += charSet.substring(randomPoz,randomPoz+1);
	                }
	                return randomstring;
	            }
	
	            var string, prio, checkd, shuf, rp, stnds, pass, compl;
	            string = "" + $('#creategamecardpool').val() + $('#creategameduelmode').val() + $('#creategametimelimit').val();
	            prio = isChecked('#enableprio') ? ("F") : ("O");
	            checkd = isChecked('#discheckdeck') ? ("F") : ("O");
	            shuf = isChecked('#disshuffledeck') ? ("F") : ("O");
	            rp = ($('#creategamepassword').val().length > 0) ? ("L") : ("");
	            stnds = "," + $('#creategamebanlist').val() + ',5,1,' + $('input:radio[name=ranked]:checked').val() + rp + ',';
	            pass = $('#creategamepassword').val() || randomString(5);
	            compl = string + prio + checkd + shuf + $('#creategamelp').val() + stnds + pass;
	            console.log(compl);
	           localStorage.roompass = compl;
	       
	            if ($('#creategamecardpool').val() == 2 && $('input:radio[name=ranked]:checked').val() == 'R') {
	                alert('OCG/TCG is not a valid mode for ranked, please select a different mode for ranked play');
	                return false;
	            }
	            if (prio + checkd + shuf !== "OOO" && $('input:radio[name=ranked]:checked').val() == 'R') {
	                alert('You may not cheat here.');
	                return false;
	            }
	            localStorage.roompass;
	            ygopro('-j')
	        }
	        var primus = Primus.connect('http://localhost:5000');
	        primus.on('data',function(data){
	           console.log(JSON.parse(data));  
	           switch (data.clientEvent){
	               case('serverMessage'):{
	                    $('#servermessages').text(data.serverMessage);
	                    break;
	                }
	                case('duelRooms'):{
	                       
	                    break;
	                }
	                case('duelRequest'):{
	                       
	                    break;
	                }
	                case('die'):{
	                       
	                        break;
	                }}
	        });
	        
	        function debug2cores(){
	            var name = localStorage.nickname;
	            ygopro('-j');
	            localStorage.nickname = 'debug';
	            ygopro('-j')
	            localStorage.nickname = 'name';
	        };
    </script>


    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->

    <script>
        var googleUA = 'UA-XXXXX-X';
	                    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
	                    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
	                    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
	                    e.src='//www.google-analytics.com/analytics.js';
	                    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
	                    ga('create', googleUA);ga('send','pageview');
    </script>
</body>

</html>

